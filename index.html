<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <script src="http://codeorigin.jquery.com/jquery-2.0.3.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/Chart.js/0.2.0/Chart.min.js"></script>
  </head>
  <body>

    <div class="container">

      <div class="starter-template">
        <h1>The most annoying blogging app ever.</h1>
        <p class="lead">As you type, we will play music for you.</p>

        <textarea name="bpm" id="bpm" rows="4" cols="50">
        
        </textarea>
      </div>
      <input type="hidden" id="starting_time" value="">
      <h2>Count: <span name="bpm_count" id="bpm_count">0</span></h2>
      <h2>BPM: <span name="bpm_calculated" id="bpm_calculated">0</span></h2>
      <div>
        <ul id="bpm_data">
          <li>0</li>
        </ul>
      </div>

      <canvas id="myChart" width="400" height="400"></canvas>

    </div><!-- /.container -->

    <script type="text/javascript">
      $(window).load(function () {
        var timeInMs = Date.now();
        $('#starting_time').text(timeInMs);
      });

      $('#bpm').on("keypress", function() {
        var cur_count_str = $('#bpm_count').text();
        var cur_count = parseInt(cur_count_str) + 1;
        $('#bpm_count').html(cur_count);
      })

      var counter=setInterval(timer, 10000); //1000 will  run it every 1 second

      function timer() {
        var bpm = calculateBPM();
        $("#bpm_data").append('<li>' + bpm + '</li>');
        return;
      };

      function calculateBPM() {
        var cur_count_str = $('#bpm_count').text();
        var cur_count = parseInt(cur_count_str);
        var begin_time = $('input#starting_time').text();
        begin_time = parseInt(begin_time);
        var end_time = Date.now();
        var diff_time = end_time - begin_time;
        var bpm = cur_count / (diff_time/1000/60)
        $('#bpm_calculated').html(bpm);
        return bpm;
      };


      // function getSong(bpm) {
      //   var echonestApiKey = 'V25FGXXBZGHBW8X1X';
      //   // http://developer.echonest.com/api/v4/song/search?api_key=V25FGXXBZGHBW8X1X&format=json&min_tempo=181.19337706966573&max_tempo=181.19337706966573&bucket=id:spotify-WW&bucket=audio_summary&bucket=tracks
      //   var get_url = "http://developer.echonest.com/api/v4/song/search?api_key=" + echonestApiKey + "&format=json&min_tempo=" + bpm + "&max_tempo=" + bpm + "&bucket=id:spotify-WW&bucket=audio_summary&bucket=tracks"
      //   console.log(get_url);
      //   $.getJSON(get_url,function(result) {
      //       if (result){
      //         parseResults();
      //         console.log(result.responseJSON.resonse.songs);
      //       }
      //   });
      // }

      function parseResults() {

      }

      var data = {
        labels : ["January","February","March","April","May","June","July"],
        datasets : [
          {
            fillColor : "rgba(220,220,220,0.5)",
            strokeColor : "rgba(220,220,220,1)",
            pointColor : "rgba(220,220,220,1)",
            pointStrokeColor : "#fff",
            data : [65,59,90,81,56,55,40]
          },
          {
            fillColor : "rgba(151,187,205,0.5)",
            strokeColor : "rgba(151,187,205,1)",
            pointColor : "rgba(151,187,205,1)",
            pointStrokeColor : "#fff",
            data : [28,48,40,19,96,27,100]
          }
        ]
      }

      //Get context with jQuery - using jQuery's .get() method.
      // var ctx = $("#myChart").get(0).getContext("2d");
      // //This will get the first returned node in the jQuery collection.
      // var myNewChart = new Chart(ctx);
      // myNewChart.Line(data);

   </script>

    <script src="http:////netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
  </body>
</html>



