<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <script src="http://codeorigin.jquery.com/jquery-2.0.3.min.js"></script>
  </head>
  <body>

    <div class="container">

      <div class="starter-template">
        <h1>The most annoying blogging app ever.</h1>
        <p class="lead">As you type, we will play music for you.</p>

        <textarea name="bpm" id="bpm" rows="4" cols="50">
        
        </textarea>
      </div>
      <input type="hidden" id="starting_time" value="">
      <h2>Count: <span name="bpm_count" id="bpm_count">0</span></h2>
      <h2>BPM: <span name="bpm_calculated" id="bpm_calculated">0</span></h2>

    </div><!-- /.container -->

    <script type="text/javascript">
      $(window).load(function () {
        var timeInMs = Date.now();
        $('#starting_time').text(timeInMs);
      });

      $('#bpm').on("keypress", function() {
        var cur_count_str = $('#bpm_count').text();
        var cur_count = parseInt(cur_count_str) + 1;
        $('#bpm_count').html(cur_count);
      })

      var counter=setInterval(timer, 10000); //1000 will  run it every 1 second

      function timer() {
        calculateBPM();
        return;
      };

      function calculateBPM() {
        var cur_count_str = $('#bpm_count').text();
        var cur_count = parseInt(cur_count_str);
        var begin_time = $('input#starting_time').text();
        begin_time = parseInt(begin_time);
        var end_time = Date.now();
        var diff_time = end_time - begin_time;
        var bpm = cur_count / (diff_time/1000/60)
        $('#bpm_calculated').html(bpm);
        getSong(bpm);
      };


      function getSong(bpm) {
        var echonestApiKey = 'V25FGXXBZGHBW8X1X';
        // http://developer.echonest.com/api/v4/song/search?api_key=V25FGXXBZGHBW8X1X&format=json&min_tempo=181.19337706966573&max_tempo=181.19337706966573&bucket=id:spotify-WW&bucket=audio_summary&bucket=tracks
        var get_url = "http://developer.echonest.com/api/v4/song/search?api_key=" + echonestApiKey + "&format=json&min_tempo=" + bpm + "&max_tempo=" + bpm + "&bucket=id:spotify-WW&bucket=audio_summary&bucket=tracks"
        console.log(get_url);
        $.getJSON(get_url,function(result) {
            if (result){
              console.log(result.responseJSON.resonse.songs);
            }
        });
      }
   </script>

   <iframe id="myiframe" src="https://embed.spotify.com/?uri=spotify:track:5CgZDknwZ24qvhq9cgI0vT" frameborder="0" allowtransparency="true">

    <script src="http:////netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
  </body>
</html>



